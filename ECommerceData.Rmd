---
title: "ECommerce Data"
author: "Galen Cheung"
date: "11/18/2021"
output: html_document
---

# E-Commerce Data

This data set ([source](https://archive.ics.uci.edu/ml/datasets/online+retail#)) consists of details of orders made in different countries from December 2010 until December 2011. The company is a UK-based online retailer that mainly sells unique all-occasions gifts. Many of its customers are wholesalers.
Take a look at some suggestions to analyze at the end of this template.

### Load packages

```{r setup, message=FALSE}
options(tidyverse.quiet = TRUE)
library(tidyverse) #import library
library(skimr) #import library
```

### Load your Data

```{r, message=FALSE}
data <- readr::read_csv('C:/Users/galen/Documents/R/Portfolio/ECommerce_Data/Online_Retail.csv') #import data
```

### View Data

```{r}
# Summarize the dataset using skimr
skim(data)
```

### Data Dictionary

**online_retail.csv**

| Variable |	Explanation |
|-----|------|
| InvoiceNo	| A 6-digit integral number uniquely assigned to each transaction. If this code starts with letter 'c' it indicates a cancellation. |
| StockCode	| A 5-digit integral number uniquely assigned to each distinct product. |
| Description |	Product (item) name |
| Quantity | The quantities of each product (item) per transaction |
| InvoiceDate |	The day and time when each transaction was generated |
| UnitPrice	| Product price per unit in sterling (pound) | 
| CustomerID | A 5-digit integral number uniquely assigned to each customer |
| Country	| The name of the country where each customer resides |

### Answer interesting questions

Now you get to explore this exciting dataset! Can't think of where to start? Try your hand at these questions:

- Find out which country has the biggest clients in terms of total orders or most money paid.

```{r, message=FALSE}
options(dplyr.summarise.inform = FALSE)
data %>%
  group_by(Country) %>% #to get groups of country
  summarize(Total_Money_Paid_By_Country = sum(Quantity*UnitPrice)) %>% #to get total amount of money per country
  arrange(desc(Total_Money_Paid_By_Country)) #sort by most money to least money

data %>%
  group_by(Country, InvoiceNo) %>% #to get groups of country, and group by InvoiceNo
  summarize(count_of_invoice = n()) %>% #to get county of individual invoices by country
  summarize(Count_of_Orders_By_Country = n()) %>% #total the counts of individual invoices for the country
  arrange(desc(Count_of_Orders_By_Country)) #sort most number of invoices to least number

#group_by(Country, InvoiceNo)
```

- Find the smallest portion of customers that drive the biggest portion of the company revenue. See the [80/20 rule](https://en.wikipedia.org/wiki/Pareto_principle).

```{r, message=FALSE}
data %>% #load data
  mutate(cust_total = UnitPrice*Quantity) %>% #create a sum of goods per item
  select(Quantity, UnitPrice, CustomerID, cust_total) %>% #select quantity, price, customer ID, and total
  group_by(CustomerID) %>% #group by customer
  summarize(cust_total = sum(cust_total)) %>% #sum the customer's purchase
  na.omit() %>% #no more NA values
  arrange(desc(cust_total)) %>% #sort
  top_frac(.2) #get top 20% of spenders 
```



- Plot the number of orders made or amount of money paid in function of time.
```{r, message=FALSE}
plt_data_num_of_orders <- data %>%
  select(InvoiceNo, InvoiceDate) %>% #get InvoiceNo and Invoice Date
  unique() #Unique InvoiceNo and Date

NumOfOrders_Date_Time <- as.factor(plt_data_num_of_orders$InvoiceDate)
NumOfOrders_Date <- strptime(NumOfOrders_Date_Time, format = '%m/%d/%Y %H:%M')

hist(as.Date(plt_data_num_of_orders$InvoiceDate,
             format = "%m/%d/%Y %H:%M"), #Format the date
            breaks = 'months', #set monthly breaks
            freq = T, #keep frequency
            xlab = 'Date', #x label
            ylab = 'Number of Orders', #y label
            main = 'Histogram of Number of Orders as a function of Time') #title

plt_data_money_paid <- data %>%
  mutate(total = UnitPrice * Quantity) %>%
  select(Quantity, UnitPrice, total, InvoiceDate) %>%
  group_by(InvoiceDate)

hist(as.Date(plt_data_money_paid$InvoiceDate,
             format = "%m/%d/%Y %H:%M"), #Format the date
            breaks = 'months', #set monthly breaks
            freq = T, #keep frequency
            xlab = 'Date', #x label
            ylab = 'Amount of Money', #y label
            main = 'Histogram of Amount of Money as a function of Time') #title
```



